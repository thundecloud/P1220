# AI 人生引擎 - 更新日志

## [未发布] - 进行中

### 新增
- 📚 **Lorebook 管理系统完整实现**（2025-12-21）
  - 路由集成：添加 `/lorebook` 路由到 App.tsx
  - Config 页面添加 Lorebook 管理入口按钮
  - Tauri 后端命令：`save_lorebook`, `load_lorebook`, `list_lorebooks`, `delete_lorebook`
  - LorebookManagement 页面完整功能：增删改查、加载状态、错误处理
  - 支持本地持久化存储（`$DOCUMENTS/AI-TRPG/lorebooks/`）
  - 浏览器开发环境支持（使用 localStorage 模拟）

### 修复
- 🔧 **选择文件夹功能权限修复**（2025-12-21）
  - 添加 `dialog:allow-open` 权限支持文件夹选择对话框
  - 扩展 `fs:read-all` 权限，允许读取任意位置的文件夹（`**`）
  - 添加 `fs:allow-read-dir` 和 `fs:allow-read-file` 权限
  - 修复在 `npm run tauri dev` 环境下无法选择文件夹的问题

- 🐛 **删除确认弹窗时序问题修复**（2025-12-21）
  - 将 `confirm` 对话框从删除处理函数移到按钮 `onClick` 事件中
  - 确保确认对话框在删除操作之前同步弹出
  - 统一 WorldlineManager 和 LorebookManagement 的确认对话框模式

- 🔧 **Tauri v2 配置修复**（2025-12-21）
  - 移除 `tauri.conf.json` 中的 Tauri 1.x 遗留配置
  - 删除 `plugins` 字段中的 v1 allowlist 风格配置（`all: true`）
  - 采用 Tauri 2.x 新权限系统（Capabilities）
  - 创建 `src-tauri/capabilities/default.json` 配置文件
  - 正确配置 shell、dialog、fs 插件权限
  - 使用权限集（`fs:default`, `fs:read-all`, `fs:write-all`）简化配置
  - 添加 `$DOCUMENT` 目录作用域

### 新增
- ⚙️ **Tauri v2 完整迁移**（2025-12-21）
  - 移除旧的 feature flags（`dialog-all`, `fs-all`, `path-all`）
  - 采用 Tauri v2 插件系统：
    - `tauri-plugin-dialog` v2：文件对话框
    - `tauri-plugin-fs` v2：文件系统操作
    - `tauri-plugin-shell` v2：Shell 命令
  - 更新 `lib.rs` 初始化所有插件
  - 安装 Rust 工具链 v1.92.0
  - 前端已使用 Tauri v2 API（`@tauri-apps/api` v2.9.1）

- 📁 **文件夹导入功能**：选择文件夹自动递归读取所有.md/.txt文件
  - Tauri 后端 `read_directory_structure` 命令
  - `SettingImportService` 服务解析目录结构为层次化 `SettingCategory`
  - WorldlineManager 支持三种导入模式：文件夹、单文件、文本粘贴

- 🌍 **自由世界观支持**：不再局限于历史世界线
  - 世界类型：历史、架空历史、奇幻、科幻、赛博朋克、末日废土、自定义
  - 新增字段：`worldType`、`physicsRules`、`technologyLevel`、`magicSystem`、`socialStructure`、`currency`、`uniqueFeatures`
  - 完全支持虚构世界的创建

- 📝 **简历级角色详细信息**：`DetailedProfile` 系统
  - 外貌描述、教育经历、工作经历、人际关系
  - 性格特征、信仰价值观、恐惧弱点、目标动机
  - 爱好兴趣、语言能力、财产资源、重要事件
  - `DetailedProfileEditor` 折叠式高级设置组件

- 🎭 **角色创建模式系统**（★SillyTavern 风格对齐）
  - **三种创建模式**：
    - **叙事模式**：自由文本描述，无需数值属性
    - **COC模式**：完整的属性和天赋系统
    - **混合模式**：叙事描述 + COC属性
  - `NarrativeDescription` 类型：描述、性格、场景、首条问候、对话示例等
  - `CreationModeSelector` 模式选择组件
  - `NarrativeDescriptionEditor` 叙事描述编辑器
  - STEP2 重构：支持根据模式动态显示不同表单
  - 灵活验证：叙事模式只需填写描述性字段，COC模式需要选择天赋

### 改进
- WorldlineManager 组件重构，增强导入功能
- Worldline 和 Character 类型大幅扩展
- **Character 类型灵活化**：所有COC字段改为可选，支持纯叙事角色
- CharacterCreation 页面重构：支持多种创建模式

### 技术
- 新增依赖：`@tauri-apps/plugin-dialog` 支持文件夹选择
- 新增服务：`SettingImportService`
- 新增类型：`FileNode`、`Education`、`WorkExperience`、`Relationship`、`PersonalityTrait`、`PhysicalAppearance`、`DetailedProfile`、`CharacterCreationMode`、`NarrativeDescription`
- 新增组件：`CreationModeSelector`、`NarrativeDescriptionEditor`

### 文档
- 新增 `更新日志.md`

---

## [0.1.0-dev] - 2025-12-20

### 新增
- ✅ **Lorebook 系统**：完整实现 SillyTavern 风格的 Lorebook
  - `LorebookService` 核心服务（触发、激活、递归扫描）
  - `LorebookEditor` 主编辑器组件
  - `LorebookEntryCard` 条目卡片组件
  - `LorebookEntryForm` 条目编辑表单（三标签页）
  - `LorebookManagement` 管理页面
  - 支持关键词触发、次级过滤、时序控制（Sticky/Cooldown/Delay）
  - 包含组和插入顺序优先级

- 🎨 **Cassette Futurism 视觉风格**：完整重构 UI
  - 温暖塑料米色色调（OKLCH color space）
  - 实体按钮凸起效果（box-shadow bevels）
  - 点阵字体（Press Start 2P + IBM Plex Mono）
  - CRT 扫描线效果
  - 物理 LED 指示灯动画
  - panel-raised 和 panel-recessed 样式系统

- 🎲 **COC 风格属性系统**：
  - 8 项基础属性（STR/CON/DEX/INT/EDU/POW/CHA/LUC）
  - 派生属性（HP/SAN/MP/MOV）
  - Box-Muller 变换生成正态分布随机数
  - 基于世界线参数的属性生成

- 🎁 **天赋系统**：
  - 稀有度加权随机抽取（common/uncommon/rare/epic/legendary）
  - 3 组 9 宫格选择机制
  - AI 提示词片段集成

- 🗺️ **世界线系统**：
  - 世界线选择界面
  - 自定义世界线管理
  - 单文件/文本粘贴导入设定

- 🔧 **基础架构**：
  - Tauri 2 + React 19 + TypeScript
  - Zustand 状态管理
  - Tailwind CSS 4 样式系统
  - 文件系统操作（Tauri 命令）
  - 配置系统

### 文档
- 创建 `Todo.md` 项目任务清单
- 创建 `Readme.md` 技术文档
- 创建 `CLAUDE.md` 项目指南

---

## 版本说明

- **未发布**：正在开发的功能
- **0.1.0-dev**：初始开发版本，核心功能框架
- **0.2.0-alpha**（计划）：完整游戏循环
- **0.3.0-beta**（计划）：性能优化和测试
- **1.0.0**（计划）：正式版发布

---

**更新日期**: 2025-12-21
**当前版本**: 0.1.0-dev
**Tauri 版本**: 2.9.x
**Rust 版本**: 1.92.0
**构建状态**: ⏳ 待验证（Tauri v2 迁移完成，需重启终端）
